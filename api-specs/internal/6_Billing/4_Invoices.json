{
  "swagger": "2.0",
  "info": {
    "title": "Billing API",
    "version": "1.0.0",
    "description": "API for managing invoices."
  },
  "basePath": "/api",
  "schemes": ["https"],
  "consumes": ["application/json"],
  "produces": ["application/json"],
  "paths": {
    "/invoices": {
      "get": {
        "summary": "Get Invoices",
        "tags": ["Invoices"],
        "description": "Retrieve a list of invoices based on status and sort order.",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "description": "Comma-separated list of invoice statuses (e.g., OPEN, EXPIRED, PAID).",
            "type": "string",
            "required": true
          },
          {
            "name": "sortOrder",
            "in": "query",
            "description": "Sort order for the invoices (e.g., asc or desc).",
            "type": "string",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Invoices retrieved successfully.",
            "schema": {
              "type": "object",
              "properties": {
                "data": {
                  "type": "array",
                  "items": {
                    "$ref": "#/definitions/Invoice"
                  },
                  "description": "List of invoices matching the criteria."
                },
                "links": {
                  "$ref": "#/definitions/PageLinks",
                  "description": "Navigation links for pagination."
                },
                "meta": {
                  "$ref": "#/definitions/Meta",
                  "description": "Metadata for pagination."
                }
              },
              "example": {
                "data": [
                  {
                    "_id": "651fb223af481407a7021564",
                    "planName": "Basic - Postpaid",
                    "orderIndex": 0,
                    "organizationId": "651fb0c787e52f315c119732",
                    "subscriptionId": "651fb18cc3f02510d40634b4",
                    "stripeInvoiceId": "in_1Ny87wFONuq90qMoX43sirFv",
                    "invoiceUrl": "https://invoice.stripe.com/i/acct_1LY2BOFONuq90qMo/test_YWNjdF8xTFkyQk9GT051cTkwcU1vLF9PbGZTQm1UV0RBY05QSEl0UWtxanBhOUJXV0RSQj72LDg3MTI5NTUx02005PCzPLqk?s=ap",
                    "invoicePdf": "https://pay.stripe.com/invoice/acct_1LY2BOFONuq90qMo/test_YWNjdF8xTFkyQk9GT051cTkwcU1vLF9PbGZTQm1UV0RBY05QSEl0UWtxanBhOUJXV0RSQj72LDg3MTI5NTUx02005PCzPLqk/pdf?s=ap",
                    "items": [
                      {
                        "priceId": "price_1M25unFONuq90qMoCdnGXIka",
                        "name": "Task",
                        "description": "Basic - Postpaid Plan, Total Task usage this period: 5.258/12.500. ",
                        "quantity": 0,
                        "subTotal": 5000000
                      }
                    ],
                    "subTotal": 5000000,
                    "tax": 550000,
                    "total": 5550000,
                    "currency": "idr",
                    "invoiceNumber": "84032444-0002",
                    "status": "EXPIRED",
                    "paymentMethod": "Bank Transfer",
                    "paidTime": null,
                    "startDate": "2023-10-06T07:01:45.000000Z",
                    "endDate": "2023-11-06T07:01:45.000000Z",
                    "dueDate": "2023-12-04T07:01:45.000000Z",
                    "updatedTime": "2023-10-06T10:39:12.995000Z",
                    "createdTime": "2023-10-06T07:07:15.416000Z",
                    "billingPeriod": null
                  }
                ],
                "links": {
                  "first": "http://localhost:82/api/invoices?status=OPEN%2CEXPIRED%2CPAID&sortOrder=asc&page=1",
                  "last": null,
                  "prev": null,
                  "next": null
                },
                "meta": {
                  "current_page": 1,
                  "from": 1,
                  "path": "http://localhost:82/api/invoices",
                  "per_page": 10,
                  "to": 1
                }
              }
            }
          }
        }
      }
    },
    "/invoice/{invoiceId}": { 
      "get": {
        "summary": "Get Invoice by ID",
        "description": "Retrieve an invoice by its ID.",
        "tags": ["Invoices"], 
        "parameters": [
          {
            "name": "invoiceId",
            "in": "path",
            "description": "ID of the invoice to retrieve.",
            "type": "string",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "Invoice retrieved successfully.",
            "schema": {
              "$ref": "#/definitions/Invoice"
            }
          },
          "404": {
            "description": "Invoice not found. Please verify the invoice number."
          }
        }
      }
    }
  },
  "definitions": {
    "Invoice": {
      "type": "object",
      "properties": {
        "_id": {
          "type": "string",
          "description": "Unique identifier for the invoice."
        },
        "planName": {
          "type": "string",
          "description": "Name of the plan associated with the invoice."
        },
        "orderIndex": {
          "type": "integer",
          "description": "Order index of the invoice."
        },
        "organizationId": {
          "type": "string",
          "description": "Unique identifier for the organization associated with the invoice."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Unique identifier for the subscription associated with the invoice."
        },
        "stripeInvoiceId": {
          "type": "string",
          "description": "Unique identifier for the Stripe invoice."
        },
        "invoiceUrl": {
          "type": "string",
          "description": "URL to view the invoice."
        },
        "invoicePdf": {
          "type": "string",
          "description": "URL to download the invoice as PDF."
        },
        "items": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/InvoiceItem"
          },
          "description": "List of invoice items."
        },
        "subTotal": {
          "type": "integer",
          "description": "Subtotal amount of the invoice."
        },
        "tax": {
          "type": "integer",
          "description": "Tax amount of the invoice."
        },
        "total": {
          "type": "integer",
          "description": "Total amount of the invoice."
        },
        "currency": {
          "type": "string",
          "description": "Currency code of the invoice."
        },
        "invoiceNumber": {
          "type": "string",
          "description": "Invoice number."
        },
        "status": {
          "type": "string",
          "description": "Status of the invoice."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the invoice."
        },
        "paidTime": {
          "type": "string",
          "description": "Timestamp of when the invoice was paid."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the invoice period."
        },
        "endDate": {
          "type": "string",
          "description": "End date of the invoice period."
        },
        "dueDate": {
          "type": "string",
          "description": "Due date of the invoice."
        },
        "updatedTime": {
          "type": "string",
          "description": "Timestamp of the last update to the invoice."
        },
        "createdTime": {
          "type": "string",
          "description": "Timestamp of when the invoice was created."
        },
        "billingPeriod": {
          "type": "string",
          "description": "Billing period information."
        }
      },
      "example": {
        "data": {
            "_id": "6523fa771fff3d49110f7004",
            "planName": "Paid",
            "orderIndex": 3,
            "organizationId": "6523685ffcab2513ab52e9fa",
            "subscriptionId": "65236a90105aa81de9066c24",
            "stripeInvoiceId": "in_1NzJ8iFONuq90qMo8PmJ2NTi",
            "invoiceUrl": "https://invoice.stripe.com/i/acct_1LY2BOFONuq90qMo/test_YWNjdF8xTFkyQk9GT051cTkwcU1vLF9PbXN1eHlPUGlkenNSaVBqTElQU0xUdlRgqR0xjVEdiLDg3Mzk3NDk302000jRs1mgC?s=ap",
            "invoicePdf": "https://pay.stripe.com/invoice/acct_1LY2BOFONuq90qMo/test_YWNjdF8xTFkyQk9GT051cTkwcU1vLF9PbXN1eHlPUGlkenNSaVBqTElQU0xUdlRgqR0xjVEdiLDg3Mzk3NDk302000jRs1mgC/pdf?s=ap",
            "items": [
            {
                "priceId": "il_1OLGYkFONuq90qMoijj8GTepP",
                "name": "Main Task",
                "description": "Paid Plan, limit for 2500 tasks.",
                "quantity": 1,
                "subTotal": 2000000
            },
            {
                "priceId": "il_1OLGYmFONuq90qMoibQdICzK",
                "name": "Task",
                "description": "1000 Extra Task from Latest Cycle (at IDR 400 / Extra Task)",
                "quantity": 1000,
                "subTotal": 400000
            }
            ],
            "subTotal": 2664000,
            "tax": 264000,
            "total": 2664000,
            "currency": "idr",
            "invoiceNumber": "D934756A-0003",
            "status": "OPEN",
            "paymentMethod": "Bank Transfer",
            "paidTime": null,
            "startDate": "2023-12-09T02:46:30.000000Z",
            "endDate": "2024-01-09T02:46:30.000000Z",
            "dueDate": "2023-12-16T02:50:00.000000Z",
            "updatedTime": "2023-10-09T13:04:58.605000Z",
            "createdTime": "2023-10-09T13:04:55.677000Z",
            "billingPeriod": null
        }
      }
    },
    "InvoiceItem": {
      "type": "object",
      "properties": {
        "priceId": {
          "type": "string",
          "description": "Unique identifier for the invoice item price."
        },
        "name": {
          "type": "string",
          "description": "Name of the invoice item."
        },
        "description": {
          "type": "string",
          "description": "Description of the invoice item."
        },
        "quantity": {
          "type": "integer",
          "description": "Quantity of the invoice item."
        },
        "subTotal": {
          "type": "integer",
          "description": "Subtotal amount for the invoice item."
        }
      }
    },
    "PageLinks": {
      "type": "object",
      "properties": {
        "first": {
          "type": "string",
          "description": "URL of the first page."
        },
        "last": {
          "type": "string",
          "description": "URL of the last page."
        },
        "prev": {
          "type": "string",
          "description": "URL of the previous page."
        },
        "next": {
          "type": "string",
          "description": "URL of the next page."
        }
      }
    },
    "Meta": {
      "type": "object",
      "properties": {
        "current_page": {
          "type": "integer",
          "description": "Current page number."
        },
        "from": {
          "type": "integer",
          "description": "Index of the first item on the current page."
        },
        "path": {
          "type": "string",
          "description": "Path to the current page."
        },
        "per_page": {
          "type": "integer",
          "description": "Number of items displayed per page."
        },
        "to": {
          "type": "integer",
          "description": "Index of the last item on the current page."
        }
      }
    }
  }
}
